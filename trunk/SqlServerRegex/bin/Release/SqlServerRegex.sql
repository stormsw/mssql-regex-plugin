/*
Deployment script for LTO
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, QUOTED_IDENTIFIER ON;

SET CONCAT_NULL_YIELDS_NULL, NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "LTO"
:setvar DefaultDataPath "D:\varchenko\LRS\SQL\MSSQL10.AVDEV\MSSQL\DATA\"
:setvar DefaultLogPath "D:\varchenko\LRS\SQL\MSSQL10.AVDEV\MSSQL\DATA\"

GO
USE [master]

GO
:on error exit
GO
USE [$(DatabaseName)]

GO
-- sp_configure 'show advanced options', 1;
-- GO
-- RECONFIGURE;
-- GO
-- sp_configure 'clr enabled', 1;
-- GO
-- RECONFIGURE;
-- GO
GO
IF EXISTS (SELECT * FROM tempdb..sysobjects WHERE id=OBJECT_ID('tempdb..#tmpErrors')) DROP TABLE #tmpErrors
GO
CREATE TABLE #tmpErrors (Error int)
GO
SET XACT_ABORT ON
GO
SET TRANSACTION ISOLATION LEVEL READ COMMITTED
GO
BEGIN TRANSACTION
GO
PRINT N'Dropping [SqlServerRegex].[SqlAssemblyProjectRoot]...';


GO
EXECUTE sp_dropextendedproperty @name = N'SqlAssemblyProjectRoot', @level0type = N'Assembly', @level0name = N'SqlServerRegex';


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[RegexMatch]...';


GO
DROP FUNCTION [dbo].[RegexMatch];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[RegexGroup]...';


GO
DROP FUNCTION [dbo].[RegexGroup];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[RegexMatchPos]...';


GO
DROP FUNCTION [dbo].[RegexMatchPos];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[RegexGroups]...';


GO
DROP FUNCTION [dbo].[RegexGroups];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [dbo].[RegexMatches]...';


GO
DROP FUNCTION [dbo].[RegexMatches];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Dropping [SqlServerRegex]...';


GO
DROP ASSEMBLY [SqlServerRegex];


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [SqlServerRegex]...';


GO
CREATE ASSEMBLY [SqlServerRegex]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103003C3A394F0000000000000000E00002210B010800001800000006000000000000CE370000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000783700005300000000400000B003000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000D4170000002000000018000000020000000000000000000000000000200000602E72737263000000B00300000040000000040000001A0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001E00000000000000000000000000004000004200000000000000000000000000000000B0370000000000004800000002000500C0250000B81100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000133003003B000000010000110F00280F00000A7E01000004731000000A0A06036F1100000A731200000A6F1300000A2606036F1100000A731200000A6F1400000A281500000A2A00133003003B000000020000110F00280F00000A7E01000004731000000A0A06036F1100000A731200000A6F1300000A0B076F1600000A2D03152B06076F1700000A281800000A2A001330030054000000020000110F00280F00000A7E01000004731000000A0A06036F1100000A731200000A6F1300000A0B076F1600000A2D06281900000A2A076F1A00000A0F02280F00000A6F1B00000A6F1C00000A281D00000A731E00000A2A62036F1100000A731200000A0F00280F00000A730D0000062A000000133003002B000000030000110274030000020A03066F0A000006731F00000A810700000104066F0B0000066F2000000A732100000A512A62036F1100000A731200000A0F00280F00000A73130000062A133003003D000000040000110274050000020A03066F0F000006731F00000A810700000104066F100000066F2000000A732100000A5105066F110000066F2000000A732100000A512A221F3080010000042A1E02282200000A2A1E027B020000042A1E027B030000042A5602282200000A02037D0200000402047D030000042A7E02282200000A02047E01000004731000000A7D0400000402037D050000042A13300400BB00000005000011027B0C0000040A064502000000050000008D000000389F00000002157D0C00000402167D0E00000402147D0F00000402027B0F0000042C0D027B0F0000046F2800000A2B1B027B0D0000047B04000004027B0D0000047B050000046F1300000A7D0F000004027B0F0000046F1600000A2C370202257B0E0000041758250B7D0E00000407027B0F0000046F1C00000A730C0000067D0B00000402177D0C000004172A02157D0C000004027B0F0000046F1600000A3A76FFFFFF162A1E027B0B0000042A1A732A00000A7A062A1E027B0B0000042A3A02282200000A02037D0C0000042A0013300200100000000600001116731A0000060A06027D0D000004062A1E027B060000042A1E027B070000042A1E027B080000042A7202282200000A02037D0600000402047D0700000402057D080000042A7E02282200000A02047E01000004731000000A7D0900000402037D0A0000042A0000001B3005006D01000007000011027B110000040B074503000000050000004701000009010000384201000002157D1100000402167D1300000402147D1400000402027B120000047B090000046F2C00000A7D1500000402257B1300000417587D1300000402027B140000042C0D027B140000046F2800000A2B1B027B120000047B09000004027B120000047B0A0000046F1300000A7D14000004027B140000046F1600000A39B300000002177D1100000402027B150000047D1800000402167D190000042B7E02027B18000004027B190000049A7D1600000402027B140000046F1A00000A027B160000046F1B00000A7D17000004027B170000046F1600000A2C3402027B13000004027B16000004027B170000046F1C00000A73120000067D1000000402187D11000004170ADE4902177D1100000402027B1900000417587D19000004027B19000004027B180000048E693F6FFFFFFF022821000006027B140000046F1600000A3AE9FEFFFF160ADE0702281E000006DC062A000000411C00000400000000000000640100006401000007000000000000001E027B100000042A1A732A00000A7A00133002001F00000008000011027B110000040A061759450200000001000000010000002A0228210000062A1E027B100000042A3A02282200000A02037D110000042A2202157D110000042A001330020010000000090000111673200000060A06027D12000004062A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000A8070000237E0000140800000C07000023537472696E677300000000200F00000800000023555300280F0000100000002347554944000000380F00008002000023426C6F6200000000000000020000015717A20B0902000000FA25330016000001000000210000000800000019000000210000001D000000080000002C00000019000000090000000400000009000000090000000A0000000100000001000000030000000600000000000A00010000000000060072006B0006008C0079000A00B70098000E00ED00D8000E00F800D8000E000201D8000E001601D8000A009F0198000600B301790006001E02FF0106004E023C02060065023C02060082023C020600A1023C020600BA023C020600D3023C020600EE023C02060009033C0206002203FF01060036033C0206006F034F0306008F034F030E00D703BC030600EC036B000A00F30398000A000D0498000A001F0498000A0030049800060096047B040600A4046B0006003E062B06060056066B0006006C064F030000000001000000000001000100010010001D0000000500010001000500100032000000050002000A00050010003C000000050004000D00050010004A000000050006000F000500100054000000050009001300030110006704000005000B0015000301100087060000050010001B003600C4000A000100710151000100820158000100A5016D000100AC0158000100710151000100CD0158000100820158000100A5016D000100AC0158000100B904C80101006205510006009805D4010600A20551000600AE05D8010100B904C80101006205510006009805EF0106009B0651000600A706D8010600B506F3010600C10658000600CC06F7010600E606F3010600F106510050200000000096000B010E00010098200000000096001F0117000300E0200000000096002D0120000500402100000000960038012B0008005C21000000009600450134000A00932100000000960052012B000D00AC210000000096005E013F000F00FE210000000086186B014D001300F5210000000091186004BE01130006220000000086087801540013000E2200000000860889015B00130016220000000086186B015F0013002C220000000086186B01710015003C2300000000E601BF017700170058230000000086087801540017006023000000008608D3015B001700682300000000860889015B00170070230000000086186B017C0017008D230000000086186B0171001A00A42500000000E601BF0177001C004C2200000000E101B004BF001C00132300000000E109C604CB011C001B2300000000E10114054D001C00222300000000E1013F054D001C00242300000000E1096D05CB011C002C230000000086186B018D001C00B02300000000E101B004BF001D00482500000000E109C604CB011D00502500000000E10114054D001D00582500000000E1013F054D001D00832500000000E1096D05CB011D008B250000000086186B018D001D009A25000000008100D8064D001E0000000100E10100000200E90100000100E10100000200E90100000100E10100000200E90100000300EF0100000100E10100000200E90100000100F40102000200F901020003002B0200000100E10100000200E90100000100F40102000200F901020003003002020004002B0200000100F90100000200360200000100E90100000200E10100000100F90100000200300200000300360200000100E90100000200E101000001006205000001006205040009000600090007000600070025000700790008000600080025000800790051006B014D0059006B01830061006B01830069006B01830071006B01830079006B01830081006B01830089006B01830091006B01830099006B018800A1006B018300A9006B018D00B1006B014D00B9006B014D00290089015B0041006B019700310089019E00C1006B01A3004100F303A9004100F903AF0021000104B400D1001304BF00D9007801540039000104C30031002704D000C9004004D500E1004B04DA00D90089015B0029000104E00031006B01E60039006B018D00C10054049E0031006B01A30009006B014D004900B004BF000C000805CF01490039054D00F1005A054D0049000805CB01C9002106E001F9006B014D0001016B014D0009016B014D004100FC06FB012000730092002E00530022022E006B0061022E00430022022E00630058022E00230022022E003B0037022E001B0022022E0013000E022E002B0028022E0033000E0240007300920060007300920080007300EC00C00073004A01E3005B01920003015B019200C0024B019200E0024B01920020034B01920040034B01920080034B019200A0034B019200E0034B01920000044B019200BA00C9004501B901E501EA01000205020902030001000500030007000600080008000000930165000000990169000000930165000000DC0169000000990169000000BC05DC010000FA05DC010000BC05DC010000FA05DC0102000A00030002000B00050002000F000700020010000900020011000B00020016000D00020019000F0002001C00110002001F00130007002A00470007002C00490007002E004B00070030004D00070032004F0008003600470008003800490008003A004B0008003C004D0008003E004F00C20104800000010000004A11EE81000000000000AD030000020000000000000000000000010062000000000002000000000000000000000001006B00000000000200000000000000000000000100CC00000000000300020004000200050002000600020007000400080006000000003C4D6F64756C653E0053716C53657276657252656765782E646C6C0055736572446566696E656446756E6374696F6E73004D617463684E6F6465004D617463684974657261746F720047726F75704E6F64650047726F75704974657261746F72006D73636F726C69620053797374656D004F626A6563740053797374656D2E436F6C6C656374696F6E730049456E756D657261626C650053797374656D2E546578742E526567756C617245787072657373696F6E730052656765784F7074696F6E73004F7074696F6E730053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C426F6F6C65616E0053716C537472696E670053716C43686172730052656765784D617463680053716C496E7433320052656765784D61746368506F7300526567657847726F75700052656765784D6174636865730046696C6C4D61746368526F7700526567657847726F7570730046696C6C47726F7570526F77002E63746F72005F696E646578006765745F496E646578005F76616C7565006765745F56616C756500496E6465780056616C7565005265676578005F7265676578005F696E7075740049456E756D657261746F7200476574456E756D657261746F72005F6E616D65006765745F4E616D65004E616D65007061747465726E00696E707574006E616D65006461746100696E6465780053797374656D2E52756E74696D652E496E7465726F705365727669636573004F757441747472696275746500746578740067726F75700076616C75650053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C7475726541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C5365727665725265676578004D6963726F736F66742E53716C5365727665722E5365727665720053716C46756E6374696F6E41747472696275746500537472696E67004D617463680049734D61746368006F705F496D706C696369740047726F7570006765745F537563636573730043617074757265006765745F4E756C6C0047726F7570436F6C6C656374696F6E006765745F47726F757073006765745F4974656D00546F436861724172726179002E6363746F72003C476574456E756D657261746F723E645F5F300053797374656D2E436F6C6C656374696F6E732E47656E657269630049456E756D657261746F7260310049446973706F7361626C65004D6F76654E657874003C3E325F5F63757272656E740053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C53797374656D2E4F626A6563743E2E6765745F43757272656E74006765745F43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E52657365740052657365740053797374656D2E49446973706F7361626C652E446973706F736500446973706F7365003C3E315F5F73746174650053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E6765745F43757272656E74003C3E345F5F74686973003C696E6465783E355F5F31003C63757272656E743E355F5F320053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C53797374656D2E4F626A6563743E2E43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E43757272656E74004E6578744D617463680053797374656D2E446961676E6F737469637300446562756767657248696464656E417474726962757465004E6F74537570706F72746564457863657074696F6E00436F6D70696C657247656E657261746564417474726962757465003C476574456E756D657261746F723E645F5F34003C696E6465783E355F5F35003C63757272656E743E355F5F36003C6E616D65733E355F5F37003C6E616D653E355F5F38003C67726F75703E355F5F39003C3E6D5F5F46696E616C6C7961003C3E375F5F7772617062003C3E375F5F77726170630047657447726F75704E616D657300000000032000000000008528C677F989054E96A91138EBB981740008B77A5C561934E0890306110D080002111111151219080002111D111512190A000312191115121911150800021209111512190A0003011C10111D1012190D0004011C10111D101219101219032000010206080320000802060E0320000E05200201080E032800080328000E03061221052002010E0E042000122506200301080E0E042001010E042001010204200101080401000000062002010E110D0420001D03052001011D0305200112650E042001020E050001111102040701122103200002050001111D08060702122112650400001219042000127105200112690E05000111150E0520010111155801000200540E1146696C6C526F774D6574686F644E616D650C46696C6C4D61746368526F77540E0F5461626C65446566696E6974696F6E205B496E6465785D20696E742C5B546578745D206E76617263686172286D617829040701120C6E01000200540E1146696C6C526F774D6574686F644E616D650C46696C6C47726F7570526F77540E0F5461626C65446566696E6974696F6E365B496E6465785D20696E742C5B47726F75705D206E76617263686172286D6178292C5B546578745D206E76617263686172286D61782904070112140300000105151275011C02061C0320001C042000130003061210030612650328001C04200012650407020808040701121C0306121803061D0E030612690420001D0E04070202080307010804070112201301000E53716C536572766572526567657800000501000000000E0100094D6963726F736F667400002001001B436F7079726967687420C2A9204D6963726F736F6674203230313200000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301A03700000000000000000000BE370000002000000000000000000000000000000000000000000000B037000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500204000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000580300000000000000000000580334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE0000010000000100EE814A1100000100EE814A113F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004B8020000010053007400720069006E006700460069006C00650049006E0066006F00000094020000010030003000300030003000340062003000000034000A00010043006F006D00700061006E0079004E0061006D006500000000004D006900630072006F0073006F0066007400000048000F000100460069006C0065004400650073006300720069007000740069006F006E0000000000530071006C00530065007200760065007200520065006700650078000000000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003400320036002E00330033003200360032000000000048001300010049006E007400650072006E0061006C004E0061006D0065000000530071006C00530065007200760065007200520065006700650078002E0064006C006C00000000005C001B0001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020004D006900630072006F0073006F006600740020003200300031003200000000005000130001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530071006C00530065007200760065007200520065006700650078002E0064006C006C000000000040000F000100500072006F0064007500630074004E0061006D00650000000000530071006C00530065007200760065007200520065006700650078000000000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003400320036002E00330033003200360032000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003400320036002E0033003300320036003200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000D03700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    WITH PERMISSION_SET = SAFE;


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Adding files to assembly [SqlServerRegex]';


GO
ALTER ASSEMBLY [SqlServerRegex]
    DROP FILE ALL
    ADD FILE FROM 0xEFBBBF7573696E672053797374656D2E5265666C656374696F6E3B0D0A7573696E672053797374656D2E52756E74696D652E436F6D70696C657253657276696365733B0D0A7573696E672053797374656D2E52756E74696D652E496E7465726F7053657276696365733B0D0A7573696E672053797374656D2E446174612E53716C3B0D0A0D0A2F2F2047656E6572616C20496E666F726D6174696F6E2061626F757420616E20617373656D626C7920697320636F6E74726F6C6C6564207468726F7567682074686520666F6C6C6F77696E670D0A2F2F20736574206F6620617474726962757465732E204368616E6765207468657365206174747269627574652076616C75657320746F206D6F646966792074686520696E666F726D6174696F6E0D0A2F2F206173736F636961746564207769746820616E20617373656D626C792E0D0A5B617373656D626C793A20417373656D626C795469746C65282253716C536572766572526567657822295D0D0A5B617373656D626C793A20417373656D626C794465736372697074696F6E282222295D0D0A5B617373656D626C793A20417373656D626C79436F6E66696775726174696F6E282222295D0D0A5B617373656D626C793A20417373656D626C79436F6D70616E7928224D6963726F736F667422295D0D0A5B617373656D626C793A20417373656D626C7950726F64756374282253716C536572766572526567657822295D0D0A5B617373656D626C793A20417373656D626C79436F707972696768742822436F7079726967687420C2A9204D6963726F736F6674203230313222295D0D0A5B617373656D626C793A20417373656D626C7954726164656D61726B282222295D0D0A5B617373656D626C793A20417373656D626C7943756C74757265282222295D0D0A0D0A5B617373656D626C793A20436F6D56697369626C652866616C7365295D0D0A0D0A2F2F0D0A2F2F2056657273696F6E20696E666F726D6174696F6E20666F7220616E20617373656D626C7920636F6E7369737473206F662074686520666F6C6C6F77696E6720666F75722076616C7565733A0D0A2F2F0D0A2F2F2020202020204D616A6F722056657273696F6E0D0A2F2F2020202020204D696E6F722056657273696F6E0D0A2F2F2020202020204275696C64204E756D6265720D0A2F2F2020202020205265766973696F6E0D0A2F2F0D0A2F2F20596F752063616E207370656369667920616C6C207468652076616C756573206F7220796F752063616E2064656661756C7420746865205265766973696F6E20616E64204275696C64204E756D626572730D0A2F2F206279207573696E672074686520272A272061732073686F776E2062656C6F773A0D0A5B617373656D626C793A20417373656D626C7956657273696F6E2822312E302E2A22295D0D0A0D0A AS N'Properties\AssemblyInfo.cs', 0xEFBBBF7573696E672053797374656D3B0D0A7573696E672053797374656D2E446174613B0D0A7573696E672053797374656D2E446174612E53716C436C69656E743B0D0A7573696E672053797374656D2E446174612E53716C54797065733B0D0A7573696E67204D6963726F736F66742E53716C5365727665722E5365727665723B0D0A7573696E672053797374656D2E546578742E526567756C617245787072657373696F6E733B0D0A7573696E672053797374656D2E436F6C6C656374696F6E733B0D0A7573696E672053797374656D2E446961676E6F73746963732E436F6465416E616C797369733B0D0A0D0A7075626C6963207061727469616C20636C6173732055736572446566696E656446756E6374696F6E730D0A7B0D0A202020207075626C69632073746174696320726561646F6E6C792052656765784F7074696F6E73204F7074696F6E73203D0D0A202020202020202052656765784F7074696F6E732E49676E6F72655061747465726E57686974657370616365207C0D0A202020202020202052656765784F7074696F6E732E53696E676C656C696E653B0D0A0D0A202020205B4D6963726F736F66742E53716C5365727665722E5365727665722E53716C46756E6374696F6E5D0D0A202020207075626C6963207374617469632053716C426F6F6C65616E2052656765784D617463682853716C537472696E67207061747465726E2C2053716C436861727320696E707574290D0A202020207B0D0A20202020202020205265676578207265676578203D206E6577205265676578287061747465726E2E56616C75652C204F7074696F6E73293B0D0A20202020202020204D61746368206D61746368203D2072656765782E4D61746368286E657720737472696E6728696E7075742E56616C756529293B0D0A202020202020202072657475726E2072656765782E49734D61746368286E657720737472696E6728696E7075742E56616C756529293B20202020202020200D0A202020207D0D0A0D0A202020205B4D6963726F736F66742E53716C5365727665722E5365727665722E53716C46756E6374696F6E5D0D0A202020207075626C6963207374617469632053716C496E7433322052656765784D61746368506F732853716C537472696E67207061747465726E2C2053716C436861727320696E707574290D0A202020207B0D0A20202020202020205265676578207265676578203D206E6577205265676578287061747465726E2E56616C75652C204F7074696F6E73293B0D0A20202020202020204D61746368206D61746368203D2072656765782E4D61746368286E657720737472696E6728696E7075742E56616C756529293B0D0A202020202020202072657475726E206D617463682E537563636573733F6D617463682E496E6465783A2D313B0D0A20202020202020200D0A202020207D0D0A0D0A202020205B4D6963726F736F66742E53716C5365727665722E5365727665722E53716C46756E6374696F6E5D0D0A202020207075626C6963207374617469632053716C436861727320526567657847726F7570280D0A202020202020202053716C537472696E67207061747465726E2C202053716C436861727320696E7075742C2053716C537472696E67206E616D65290D0A202020207B0D0A20202020202020205265676578207265676578203D206E6577205265676578287061747465726E2E56616C75652C204F7074696F6E73293B0D0A20202020202020204D61746368206D61746368203D2072656765782E4D61746368286E657720737472696E6728696E7075742E56616C756529293B0D0A202020202020202072657475726E206D617463682E53756363657373203F0D0A2020202020202020202020206E65772053716C4368617273286D617463682E47726F7570735B6E616D652E56616C75655D2E56616C756529203A2053716C43686172732E4E756C6C3B0D0A202020207D0D0A0D0A20202020696E7465726E616C20636C617373204D617463684E6F64650D0A202020207B0D0A20202020202020207072697661746520696E74205F696E6465783B0D0A20202020202020207075626C696320696E7420496E646578207B20676574207B2072657475726E205F696E6465783B207D207D0D0A0D0A20202020202020207072697661746520737472696E67205F76616C75653B0D0A20202020202020207075626C696320737472696E672056616C7565207B20676574207B2072657475726E205F76616C75653B207D207D0D0A0D0A20202020202020207075626C6963204D617463684E6F646528696E7420696E6465782C20737472696E672076616C7565290D0A20202020202020207B0D0A2020202020202020202020205F696E646578203D20696E6465783B0D0A2020202020202020202020205F76616C7565203D2076616C75653B0D0A20202020202020207D0D0A202020207D0D0A0D0A20202020696E7465726E616C20636C617373204D617463684974657261746F72203A2049456E756D657261626C650D0A202020207B0D0A202020202020202070726976617465205265676578205F72656765783B0D0A20202020202020207072697661746520737472696E67205F696E7075743B0D0A0D0A20202020202020207075626C6963204D617463684974657261746F7228737472696E6720696E7075742C20737472696E67207061747465726E290D0A20202020202020207B0D0A2020202020202020202020205F7265676578203D206E6577205265676578287061747465726E2C2055736572446566696E656446756E6374696F6E732E4F7074696F6E73293B0D0A2020202020202020202020205F696E707574203D20696E7075743B0D0A20202020202020207D0D0A0D0A20202020202020207075626C69632049456E756D657261746F7220476574456E756D657261746F7228290D0A20202020202020207B0D0A202020202020202020202020696E7420696E646578203D20303B0D0A2020202020202020202020204D617463682063757272656E74203D206E756C6C3B0D0A202020202020202020202020646F0D0A2020202020202020202020207B0D0A2020202020202020202020202020202063757272656E74203D202863757272656E74203D3D206E756C6C29203F0D0A20202020202020202020202020202020202020205F72656765782E4D61746368285F696E70757429203A2063757272656E742E4E6578744D6174636828293B0D0A202020202020202020202020202020206966202863757272656E742E53756363657373290D0A202020202020202020202020202020207B0D0A20202020202020202020202020202020202020207969656C642072657475726E206E6577204D617463684E6F6465282B2B696E6465782C2063757272656E742E56616C7565293B0D0A202020202020202020202020202020207D0D0A2020202020202020202020207D0D0A2020202020202020202020207768696C65202863757272656E742E53756363657373293B0D0A20202020202020207D0D0A202020207D0D0A0D0A202020205B53716C46756E6374696F6E2846696C6C526F774D6574686F644E616D65203D202246696C6C4D61746368526F77222C0D0A202020205461626C65446566696E6974696F6E203D20225B496E6465785D20696E742C5B546578745D206E76617263686172286D61782922295D0D0A202020207075626C6963207374617469632049456E756D657261626C652052656765784D6174636865732853716C537472696E67207061747465726E2C2053716C436861727320696E707574290D0A202020207B0D0A202020202020202072657475726E206E6577204D617463684974657261746F72286E657720737472696E6728696E7075742E56616C7565292C207061747465726E2E56616C7565293B0D0A202020207D0D0A0D0A202020205B53757070726573734D65737361676528224D6963726F736F66742E44657369676E222C20224341313032313A41766F69644F7574506172616D657465727322295D0D0A202020207075626C69632073746174696320766F69642046696C6C4D61746368526F77286F626A65637420646174612C0D0A20202020202020206F75742053716C496E74333220696E6465782C206F75742053716C43686172732074657874290D0A202020207B0D0A20202020202020204D617463684E6F6465206E6F6465203D20284D617463684E6F646529646174613B0D0A2020202020202020696E646578203D206E65772053716C496E743332286E6F64652E496E646578293B0D0A202020202020202074657874203D206E65772053716C4368617273286E6F64652E56616C75652E546F4368617241727261792829293B0D0A202020207D0D0A0D0A20202020696E7465726E616C20636C6173732047726F75704E6F64650D0A202020207B0D0A20202020202020207072697661746520696E74205F696E6465783B0D0A20202020202020207075626C696320696E7420496E646578207B20676574207B2072657475726E205F696E6465783B207D207D0D0A0D0A20202020202020207072697661746520737472696E67205F6E616D653B0D0A20202020202020207075626C696320737472696E67204E616D65207B20676574207B2072657475726E205F6E616D653B207D207D0D0A0D0A20202020202020207072697661746520737472696E67205F76616C75653B0D0A20202020202020207075626C696320737472696E672056616C7565207B20676574207B2072657475726E205F76616C75653B207D207D0D0A0D0A20202020202020207075626C69632047726F75704E6F646528696E7420696E6465782C20737472696E672067726F75702C20737472696E672076616C7565290D0A20202020202020207B0D0A2020202020202020202020205F696E646578203D20696E6465783B0D0A2020202020202020202020205F6E616D65203D2067726F75703B0D0A2020202020202020202020205F76616C7565203D2076616C75653B0D0A20202020202020207D0D0A202020207D0D0A0D0A20202020696E7465726E616C20636C6173732047726F75704974657261746F72203A2049456E756D657261626C650D0A202020207B0D0A202020202020202070726976617465205265676578205F72656765783B0D0A20202020202020207072697661746520737472696E67205F696E7075743B0D0A0D0A20202020202020207075626C69632047726F75704974657261746F7228737472696E6720696E7075742C20737472696E67207061747465726E290D0A20202020202020207B0D0A2020202020202020202020205F7265676578203D206E6577205265676578287061747465726E2C2055736572446566696E656446756E6374696F6E732E4F7074696F6E73293B0D0A2020202020202020202020205F696E707574203D20696E7075743B0D0A20202020202020207D0D0A0D0A20202020202020207075626C69632049456E756D657261746F7220476574456E756D657261746F7228290D0A20202020202020207B0D0A202020202020202020202020696E7420696E646578203D20303B0D0A2020202020202020202020204D617463682063757272656E74203D206E756C6C3B0D0A202020202020202020202020737472696E675B5D206E616D6573203D205F72656765782E47657447726F75704E616D657328293B0D0A202020202020202020202020646F0D0A2020202020202020202020207B0D0A20202020202020202020202020202020696E6465782B2B3B0D0A2020202020202020202020202020202063757272656E74203D202863757272656E74203D3D206E756C6C29203F0D0A20202020202020202020202020202020202020205F72656765782E4D61746368285F696E70757429203A2063757272656E742E4E6578744D6174636828293B0D0A202020202020202020202020202020206966202863757272656E742E53756363657373290D0A202020202020202020202020202020207B0D0A2020202020202020202020202020202020202020666F72656163682028737472696E67206E616D6520696E206E616D6573290D0A20202020202020202020202020202020202020207B0D0A20202020202020202020202020202020202020202020202047726F75702067726F7570203D2063757272656E742E47726F7570735B6E616D655D3B0D0A2020202020202020202020202020202020202020202020206966202867726F75702E53756363657373290D0A2020202020202020202020202020202020202020202020207B0D0A202020202020202020202020202020202020202020202020202020207969656C642072657475726E206E65772047726F75704E6F6465280D0A2020202020202020202020202020202020202020202020202020202020202020696E6465782C206E616D652C2067726F75702E56616C7565293B0D0A2020202020202020202020202020202020202020202020207D0D0A20202020202020202020202020202020202020207D0D0A202020202020202020202020202020207D0D0A2020202020202020202020207D0D0A2020202020202020202020207768696C65202863757272656E742E53756363657373293B0D0A20202020202020207D0D0A202020207D0D0A0D0A202020205B53716C46756E6374696F6E2846696C6C526F774D6574686F644E616D65203D202246696C6C47726F7570526F77222C205461626C65446566696E6974696F6E203D0D0A20202020225B496E6465785D20696E742C5B47726F75705D206E76617263686172286D6178292C5B546578745D206E76617263686172286D61782922295D0D0A202020207075626C6963207374617469632049456E756D657261626C650D0A2020202020202020526567657847726F7570732853716C537472696E67207061747465726E2C2053716C436861727320696E707574290D0A202020207B0D0A202020202020202072657475726E206E65772047726F75704974657261746F72286E657720737472696E6728696E7075742E56616C7565292C207061747465726E2E56616C7565293B0D0A202020207D0D0A0D0A202020205B53757070726573734D65737361676528224D6963726F736F66742E44657369676E222C20224341313032313A41766F69644F7574506172616D657465727322295D0D0A202020207075626C69632073746174696320766F69642046696C6C47726F7570526F77286F626A65637420646174612C0D0A20202020202020206F75742053716C496E74333220696E6465782C206F75742053716C43686172732067726F75702C206F75742053716C43686172732074657874290D0A202020207B0D0A202020202020202047726F75704E6F6465206E6F6465203D202847726F75704E6F646529646174613B0D0A2020202020202020696E646578203D206E65772053716C496E743332286E6F64652E496E646578293B0D0A202020202020202067726F7570203D206E65772053716C4368617273286E6F64652E4E616D652E546F4368617241727261792829293B0D0A202020202020202074657874203D206E65772053716C4368617273286E6F64652E56616C75652E546F4368617241727261792829293B0D0A202020207D0D0A7D3B0D0A0D0A AS N'RegexMatch.cs';


GO
PRINT N'Creating [dbo].[RegexMatch]...';


GO
CREATE FUNCTION [dbo].[RegexMatch]
(@pattern NVARCHAR (4000), @input NVARCHAR (MAX))
RETURNS BIT
AS
 EXTERNAL NAME [SqlServerRegex].[UserDefinedFunctions].[RegexMatch]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[RegexGroup]...';


GO
CREATE FUNCTION [dbo].[RegexGroup]
(@pattern NVARCHAR (4000), @input NVARCHAR (MAX), @name NVARCHAR (4000))
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [SqlServerRegex].[UserDefinedFunctions].[RegexGroup]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[RegexMatchPos]...';


GO
CREATE FUNCTION [dbo].[RegexMatchPos]
(@pattern NVARCHAR (4000), @input NVARCHAR (MAX))
RETURNS INT
AS
 EXTERNAL NAME [SqlServerRegex].[UserDefinedFunctions].[RegexMatchPos]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[RegexGroups]...';


GO
CREATE FUNCTION [dbo].[RegexGroups]
(@pattern NVARCHAR (4000), @input NVARCHAR (MAX))
RETURNS 
     TABLE (
        [Index] INT            NULL,
        [Group] NVARCHAR (MAX) NULL,
        [Text]  NVARCHAR (MAX) NULL)
AS
 EXTERNAL NAME [SqlServerRegex].[UserDefinedFunctions].[RegexGroups]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [dbo].[RegexMatches]...';


GO
CREATE FUNCTION [dbo].[RegexMatches]
(@pattern NVARCHAR (4000), @input NVARCHAR (MAX))
RETURNS 
     TABLE (
        [Index] INT            NULL,
        [Text]  NVARCHAR (MAX) NULL)
AS
 EXTERNAL NAME [SqlServerRegex].[UserDefinedFunctions].[RegexMatches]


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
PRINT N'Creating [SqlServerRegex].[SqlAssemblyProjectRoot]...';


GO
EXECUTE sp_addextendedproperty @name = N'SqlAssemblyProjectRoot', @value = N'd:\test\SqlServerRegex\SqlServerRegex', @level0type = N'Assembly', @level0name = N'SqlServerRegex';


GO
IF @@ERROR <> 0
   AND @@TRANCOUNT > 0
    BEGIN
        ROLLBACK;
    END

IF @@TRANCOUNT = 0
    BEGIN
        INSERT  INTO #tmpErrors (Error)
        VALUES                 (1);
        BEGIN TRANSACTION;
    END


GO
IF EXISTS (SELECT * FROM #tmpErrors) ROLLBACK TRANSACTION
GO
IF @@TRANCOUNT>0 BEGIN
PRINT N'The transacted portion of the database update succeeded.'
COMMIT TRANSACTION
END
ELSE PRINT N'The transacted portion of the database update failed.'
GO
DROP TABLE #tmpErrors
GO
